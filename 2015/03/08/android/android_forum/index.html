<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Android Forum 基础实践 | Xiongmin Lin</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="AbstractISIMA 的Android 实验作业，写一个类似论坛的app，能实现读取信息，上传信息，使得用户能互相通信。">
<meta name="keywords" content="android programming">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Forum 基础实践">
<meta property="og:url" content="http://yoursite.com/2015/03/08/android/android_forum/index.html">
<meta property="og:site_name" content="Xiongmin Lin">
<meta property="og:description" content="AbstractISIMA 的Android 实验作业，写一个类似论坛的app，能实现读取信息，上传信息，使得用户能互相通信。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/690aa174jw1ep3l0pntspj20ks0e6761.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/690aa174jw1ep3shy042kj20ks0e6jtl.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/large/690aa174jw1ep3tqd8u4mj20lm0jytek.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/690aa174gw1epsv90uo4jj20fk08zabd.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/690aa174gw1epsz5ub4kmj209u0d5mxi.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/690aa174gw1epsz75e3f2j208g0cvwey.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/690aa174gw1epsz86ue6rj20790ctdg1.jpg">
<meta property="og:updated_time" content="2015-03-21T14:14:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Forum 基础实践">
<meta name="twitter:description" content="AbstractISIMA 的Android 实验作业，写一个类似论坛的app，能实现读取信息，上传信息，使得用户能互相通信。">
<meta name="twitter:image" content="http://ww4.sinaimg.cn/large/690aa174jw1ep3l0pntspj20ks0e6761.jpg">

  
    <link rel="alternate" href="/atom.xml" title="Xiongmin Lin" type="application/atom+xml">
  

  
  <!--[if lte IE 10 ]><link rel="shortcut icon" href="/images/favicon.ico"><![endif]-->
  <!--[if !IE]><!-->
  <link rel="shortcut icon" href="/images/favicon.png">

  <meta name="msapplication-TileImage" content="/images/favicon.png">
  <meta name="msapplication-TileColor" content="#000000">

  <link rel="apple-touch-icon" href="/images/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png">

  <link rel="icon" sizes="256x256" href="/images/favicon.png">
  <!--<![endif]-->
  

  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro|Material+Icons|Raleway:400,300,700" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/css/vendors.css">
  <link rel="stylesheet" href="/css/style.css">
  


  <script src="/js/vendors.js"></script>

  <script>
    define('jquery', function () {
      return window.jQuery;
    });
  </script>


</head>
<body>

  <div class="navbar-fixed">
  <nav id="main-navbar" class="grey lighten-5 z-depth-0" role="navigation">
    <div class="nav-wrapper container">

      <a id="logo-container" href="/" class="brand-logo center-align">
        <span>Xiongmin Lin</span>
        <sub></sub>
      </a>

      <ul class="right hide-on-med-and-down">
        
          <li>
            <a class="main-nav-link" href="/">Home</a>
          </li>
        
          <li>
            <a class="main-nav-link" href="/blog">Blog</a>
          </li>
        
      </ul>

      <a href="#" data-activates="nav-mobile" class="button-collapse">
        <i class="material-icons">menu</i>
      </a>
    </div>
  </nav>
</div>

<ul id="nav-mobile" class="side-nav">
  
  <li>
    <a class="main-nav-link" href="/">Home</a>
  </li>
  
  <li>
    <a class="main-nav-link" href="/blog">Blog</a>
  </li>
  
</ul>


  <div id="main-container">
    
<div class="container">
  <div class="row">
    <div class="col s12">


      <article id="post-android/android_forum" class="article article-type-post" itemscope="" itemprop="blogPost">

        <div class="article-inner">
          

          <header class="article-header">
          
              
  
    <h1 class="article-title header" itemprop="name">
      Android Forum 基础实践
    </h1>
  


          

            <div class="article-meta">
              <i class="fa fa-calendar"></i>
              <time datetime="2015-03-08T08:00:00.000Z" itemprop="datePublished">Mar 08, 2015</time>
            </div>
          </header>


          <div class="article-entry " itemprop="articleBody">
            
              <h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>ISIMA 的Android 实验作业，写一个类似论坛的app，能实现读取信息，上传信息，使得用户能互相通信。</p>
<a id="more"></a>
<h1 id="json-amp-amp-activity"><a href="#json-amp-amp-activity" class="headerlink" title="json &amp;&amp; activity"></a>json &amp;&amp; activity</h1><h2 id="实验需求"><a href="#实验需求" class="headerlink" title="实验需求"></a>实验需求</h2><p>ISIMA Android实验课程，需要读取Json文件，实现类似图1.1的功能。<br>关键词： json, Intent, Activity</p>
<p><img src="http://ww4.sinaimg.cn/large/690aa174jw1ep3l0pntspj20ks0e6761.jpg" alt="实验效果图"><br>“图1.1 效果图”</p>
<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><ul>
<li>2.1 读取并解析 Json 文件</li>
<li>2.2 按钮响应与添加新的 activity</li>
<li>2.3 Activity间的通信</li>
</ul>
<h3 id="读取并解析-Json-文件"><a href="#读取并解析-Json-文件" class="headerlink" title="读取并解析 Json 文件"></a>读取并解析 Json 文件</h3><h4 id="Json-文件"><a href="#Json-文件" class="headerlink" title="Json 文件"></a>Json 文件</h4><blockquote>
<p>JSON (JavaScript Object Notation) is a lightweight data-interchange format. It is easy for humans to read and write. It is easy for machines to parse and generate. It is based on a subset of the JavaScript Programming Language, Standard ECMA-262 3rd Edition - December 1999. JSON is a text format that is completely language independent but uses conventions that are familiar to programmers of the C-family of languages, including C, C++, C#, Java, JavaScript, Perl, Python, and many others. These properties make JSON an ideal data-interchange language.</p>
</blockquote>
<blockquote>
<ul>
<li><a href="http://json.org/" target="_blank" rel="noopener">Json</a></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;&quot;title&quot;:&quot;Titre 1&quot;,&quot;author&quot;:&quot;Auteur 1&quot;,&quot;message&quot;:&quot;Message 1&quot;,&quot;id&quot;:2,&quot;timestamp&quot;:1422400424&#125;,</span><br><span class="line">&#123;&quot;title&quot;:&quot;Titre 2&quot;,&quot;author&quot;:&quot;Auteur 2&quot;,&quot;message&quot;:&quot;Message 2&quot;,&quot;id&quot;:3,&quot;timestamp&quot;:1422400428&#125;</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>将json文件，保存到res/raw文件夹中。（需新建raw文件夹）</p>
<h4 id="添加java类：-Post-java"><a href="#添加java类：-Post-java" class="headerlink" title="添加java类： Post.java"></a>添加java类： Post.java</h4><p>添加成员变量title, author, message, timetamp及相应的set &amp;&amp; get函数。<br>注意，为了 “2.3 activity间的通信”使用Serializable方法， Post类的声明需包含Serializable。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Post implements Serializable&#123;</span><br><span class="line">    private String title;</span><br><span class="line">    private String author;</span><br><span class="line">    private String message;</span><br><span class="line">    private String timestamp;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="读取与解析"><a href="#读取与解析" class="headerlink" title="读取与解析"></a>读取与解析</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 调用方法：</span><br><span class="line">// ArrayList&lt;Post&gt; posts = readPostsFromJsonFile(R.raw.data);</span><br><span class="line">   public ArrayList&lt;Post&gt; readPostsFromJsonFile(int resourceId) &#123;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, &quot;Reading posts from JSON file...&quot;);</span><br><span class="line">        ArrayList&lt;Post&gt; posts = new ArrayList();</span><br><span class="line"></span><br><span class="line">        // read and deserialize the file</span><br><span class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(getResources().openRawResource(resourceId)));</span><br><span class="line"></span><br><span class="line">        //get json array from buffered reader</span><br><span class="line">        JsonElement jsonElement = new JsonParser().parse(br);</span><br><span class="line">        JsonArray jsonArray = jsonElement.getAsJsonArray();</span><br><span class="line"></span><br><span class="line">        // create posts from JSON elements and add it to the list</span><br><span class="line">        Gson gson = new Gson();</span><br><span class="line"></span><br><span class="line">        Type listType = new TypeToken&lt;ArrayList&lt;Post&gt;&gt;() &#123;&#125;.getType();</span><br><span class="line">        try &#123;</span><br><span class="line">            posts = gson.fromJson(jsonArray, listType);</span><br><span class="line">            //Log.d(TAG, &quot;parse json, size: &quot; + m_posts.size());</span><br><span class="line">        &#125;catch (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.d(TAG, &quot;some errors occur when parse json: &quot; + e.getMessage());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, &quot;Read JSON file successfully.&quot;);</span><br><span class="line"></span><br><span class="line">        // return a list with the deserialized posts</span><br><span class="line">        return posts;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="按钮响应与添加新的-activity"><a href="#按钮响应与添加新的-activity" class="headerlink" title="按钮响应与添加新的 activity"></a>按钮响应与添加新的 activity</h3><h4 id="添加按钮及响应函数"><a href="#添加按钮及响应函数" class="headerlink" title="添加按钮及响应函数"></a>添加按钮及响应函数</h4><p>目标： 为主界面添加 Random 按钮</p>
<p>对于任意的activity， 控件的添加都在其对应的 xml 文件中完成。</p>
<p>双击activity_main.xml， 为主界面拉拽一按钮。 为按钮添加响应函数 Search_Random<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Random&quot;</span><br><span class="line">        android:id=&quot;@+id/button_R&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:onClick=&quot;Search_Random&quot; /&gt;    //为按钮添加响应函数 Search_Random</span><br></pre></td></tr></table></figure></p>
<p>在 MainActivity.java中添加 Search_Random</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void Search_Random(View v)</span><br><span class="line"> &#123;</span><br><span class="line">     //...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="添加新的activity"><a href="#添加新的activity" class="headerlink" title="添加新的activity"></a>添加新的activity</h4><p>目标： 添加显示 post 具体信息的界面， 即activity。</p>
<p>在Android Studio 左侧的app处右键， new -&gt; activity -&gt; blank activity。 这里添加DisplayMessageActivity。 </p>
<p>添加 DisplayMessageActivity 完成后， res/layout文件夹下会多出activity_display_message.xml。 </p>
<p>为按钮显示新的activity.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void action_buttonSearch(View v) &#123;</span><br><span class="line"></span><br><span class="line">    // create an new intent</span><br><span class="line">    Intent i = new Intent(getApplicationContext(), DisplayMessageActivity.class);</span><br><span class="line">    // start the new activity</span><br><span class="line">    startActivity(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="activity间的通信"><a href="#activity间的通信" class="headerlink" title="activity间的通信"></a>activity间的通信</h3><p>目标： 将自定义类Post的实例p作为参数传递给DisplayMessageActivity.</p>
<p>在MainActivity中，将类Post的实例p作为参数传递给DisplayMessageActivity</p>
<p>MainActivity.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void Search_Random(View v)</span><br><span class="line">    &#123;</span><br><span class="line">        Random rand = new Random();</span><br><span class="line">        int rand_num = rand.nextInt(posts.size() - 1);</span><br><span class="line">        Post p = posts.get(rand_num);</span><br><span class="line">        Intent intent = new Intent(getApplicationContext(), DisplayMessageActivity.class);</span><br><span class="line">        Bundle bundle = new Bundle();</span><br><span class="line">        bundle.putSerializable(SHOW_POST_MESSAGE, p);</span><br><span class="line">        intent.putExtras(bundle);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>DisplayMessageActivity.java 的 onCreate 函数里添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">	Intent intent = getIntent();</span><br><span class="line">	Post cur_p = (Post)intent.getSerializableExtra(MainActivity.SHOW_POST_MESSAGE);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>注意， 两个activity的消息要匹配。如这里 intent.getSerializableExtra 函数的第一个参数要与 bundle.putSerializable函数的第一个参数一致， 都为SHOW_POST_MESSAGE所代表的 “show_post_message” 字符串。    </p>
<h1 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h1><h2 id="实验需求："><a href="#实验需求：" class="headerlink" title="实验需求："></a>实验需求：</h2><p>ISIMA Android实验课程，将Post信息按列排序，并能查阅，添加信息。实现类似图1.1的功能。</p>
<p><img src="http://ww1.sinaimg.cn/large/690aa174jw1ep3shy042kj20ks0e6jtl.jpg" alt="实验效果图"><br>“图1.1 效果图”</p>
<h2 id="实验步骤-1"><a href="#实验步骤-1" class="headerlink" title="实验步骤"></a>实验步骤</h2><ul>
<li>2.1 Post信息的显示： ListView 与 Adapter的使用</li>
<li>2.2 Post信息的添加与Activity间的数据的同步</li>
</ul>
<h3 id="Post信息的显示：-ListView-与-Adapter的使用"><a href="#Post信息的显示：-ListView-与-Adapter的使用" class="headerlink" title="Post信息的显示： ListView 与 Adapter的使用"></a>Post信息的显示： ListView 与 Adapter的使用</h3><p>目标： 主界面以列表的形式显示所有信息， 当用户点击ListView中的某一子项时，程序跳转， 显示详细信息。</p>
<p>在控件中拖拽 ListView 至 MainActivity， 并在MainActivity.java中添加成员变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private ListView list_view;</span><br></pre></td></tr></table></figure>
<p>在MainActivity.java中添加成员函数Set_Posts_To_List_View，负责将Post数组显示到主界面。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void Set_Posts_To_List_View(ArrayList&lt;Post&gt; posts)</span><br><span class="line">&#123;</span><br><span class="line">    /*add the authors to each ListView item using Adapter*/</span><br><span class="line">    Log.d(TAG, &quot;Set_Posts_To_List_View starts...&quot;);</span><br><span class="line">    ArrayList&lt;String&gt; authors = new ArrayList&lt;String&gt;();</span><br><span class="line">    for (int i = 0; i &lt; posts.size(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        authors.add(posts.get(i).getAuthor());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    list_view = (ListView)findViewById(R.id.listView_Main);</span><br><span class="line">    list_view.setAdapter(new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, authors));</span><br><span class="line"></span><br><span class="line">    /*listen to user&apos;s command and respond*/</span><br><span class="line">    list_view.setOnItemClickListener(new ItemClickEvent());</span><br><span class="line">    Log.d(TAG, &quot;Set_Posts_To_List_View ends...&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意 1： 通过调用ListView的setAdapter方法，可以将Post信息显示到主界面上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list_view = (ListView)findViewById(R.id.listView_Main);</span><br><span class="line">       list_view.setAdapter(new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, authors));</span><br></pre></td></tr></table></figure>
<p>注意 2： 通过ListView的setOnItemClickListener方法， 开始监听用户点击列表项的实践。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_view.setOnItemClickListener(new ItemClickEvent());</span><br></pre></td></tr></table></figure>
<p>对于监听的实现函数： ItemClickEvent， 其实现如下，其中arg2参数代表用户点击的位置。<br>用户点击ListView某一位置时， 使用intent方法（具体参见上篇博文）， 将Post的详细信息传递给DisplayMessageActivity.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private final class ItemClickEvent implements AdapterView.OnItemClickListener</span><br><span class="line">&#123;</span><br><span class="line">    /*arg2 is where user clicks*/</span><br><span class="line">    public void onItemClick(AdapterView&lt;?&gt; arg0, View arg1, int arg2, long arg3)</span><br><span class="line">    &#123;</span><br><span class="line">        String str = (String)list_view.getItemAtPosition(arg2);</span><br><span class="line">        Log.d(TAG, arg2 + &quot; was clicked: &quot; + str);</span><br><span class="line"></span><br><span class="line">        /*create a DisplayMessageActivity to show the detail message*/</span><br><span class="line">        Post p = posts.get(arg2);</span><br><span class="line">        Intent intent = new Intent(getApplicationContext(), DisplayMessageActivity.class);</span><br><span class="line">        Bundle bundle = new Bundle();</span><br><span class="line">        bundle.putSerializable(MainActivity.SHOW_POST_MESSAGE, p);</span><br><span class="line">        intent.putExtras(bundle);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Post信息的添加与Activity间的数据的同步"><a href="#Post信息的添加与Activity间的数据的同步" class="headerlink" title="Post信息的添加与Activity间的数据的同步"></a>Post信息的添加与Activity间的数据的同步</h3><p>目标： 用户能自己添加新的Post信息， 并且该信息能被记录。</p>
<p>首先， 为了不同 Activity 都能修改posts的信息， posts可以声明为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static ArrayList&lt;Post&gt; posts = null;</span><br></pre></td></tr></table></figure>
<p>当用户点击MainActivity界面的 Add a Message 按钮时。弹出新的界面： AddMessageActivity。 其响应函数如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void Add_Message(View v)</span><br><span class="line">&#123;</span><br><span class="line">    Log.d(TAG, &quot;you click Add Message Button&quot;);</span><br><span class="line">    Intent intent = new Intent(getApplicationContext(), AddMessageActivity.class);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户在AddMessageActivity界面添加新信息以后，新信息被写入到posts里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MainActivity.posts.add(p);</span><br></pre></td></tr></table></figure>
<p>此时， 若退出 AddMessageActivity，返回主界面 MainActivity时， 会发现主界面的post列表里并没有显示新添加的信息。 因此， 这里为 MainActivity 设置了一个定时器及一个 boolean 型变量 Update， 当有信息变更时， Update将被设置为true.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static boolean Update = false;</span><br></pre></td></tr></table></figure>
<p>MainActivity的定时器不断检测Update的值， 若 Update 为 true, 则刷新adapter， 再将 Update 设置位false.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private Handler handler = new Handler();</span><br><span class="line">    private Runnable runnable = new Runnable() &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            this.update();</span><br><span class="line">            handler.postDelayed(this, 500);// update every 0.5 seconds</span><br><span class="line">        &#125;</span><br><span class="line">        void update() &#123;</span><br><span class="line">            /*when posts are refreshed, Update will be set true*/</span><br><span class="line">            if(Update == true) &#123;</span><br><span class="line">                Log.d(TAG, &quot;update the data, posts size: &quot; + posts.size());</span><br><span class="line">                Set_Posts_To_List_View(posts);</span><br><span class="line">                Update = false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>最终程序部分效果图。</p>
<p><img src="http://ww2.sinaimg.cn/large/690aa174jw1ep3tqd8u4mj20lm0jytek.jpg" alt="最终程序部分效果图"></p>
<h1 id="fragment"><a href="#fragment" class="headerlink" title="fragment"></a>fragment</h1><h2 id="实验需求-1"><a href="#实验需求-1" class="headerlink" title="实验需求"></a>实验需求</h2><p>ISIMA Android 实验课程，调整前面的代码，使得程序能同时在手机和平板上正常运行。<br><img src="http://ww1.sinaimg.cn/large/690aa174gw1epsv90uo4jj20fk08zabd.jpg" alt="效果图"></p>
<blockquote>
<p>Android introduced fragments in Android 3.0 (API level 11), primarily to support more dynamic and flexible UI designs on large screens, such as tablets. Because a tablet s screen is much larger than that of a handset, there s more room to combine and interchange UI components. Fragments allow such designs without the need for you to manage complex changes to the view hierarchy. By dividing the layout of an activity into fragments, you become able to modify the activity s appearance at runtime and preserve those changes in a back stack that s managed by the activity.</p>
<ul>
<li><a href="http://developer.android.com/guide/components/fragments.html#Design" target="_blank" rel="noopener">Fragment Design Philosophy</a></li>
</ul>
</blockquote>
<blockquote>
<p>A Fragment represents a behavior or a portion of user interface in an Activity. You can combine multiple fragments in a single activity to build a multi-pane UI and reuse a fragment in multiple activities. You can think of a fragment as a modular section of an activity, which has its own lifecycle, receives its own input events, and which you can add or remove while the activity is running (sort of like a “sub activity” that you can reuse in different activities).<br>A fragment must always be embedded in an activity and the fragment s lifecycle is directly affected by the host activity s lifecycle. </p>
<ul>
<li><a href="http://developer.android.com/guide/components/fragments.html#Design" target="_blank" rel="noopener">fragment and activity</a></li>
</ul>
</blockquote>
<p>总结： fragment, 为平板而生。</p>
<h2 id="实验步骤-2"><a href="#实验步骤-2" class="headerlink" title="实验步骤"></a>实验步骤</h2><ul>
<li>原程序移植</li>
<li>添加“适应平板”功能<h3 id="原程序移植"><a href="#原程序移植" class="headerlink" title="原程序移植"></a>原程序移植</h3></li>
<li>添加fragment</li>
<li>主界面移植</li>
<li>消息显示界面移植</li>
<li>添加消息界面移植</li>
</ul>
<p>目标： 将源程序移植成fragment模式,并能正常使用。<br>关键词： Fragment, getFragmentManager, bundle, container, layout<br>方法： 添加ListFragment, DetailFragment, AddFragment, 同时为原来的activity_main.xml, activity_display_message.xml, activity_add_message.xml 添加container, 同时将各个控件剪切到对应的fragment，并排列整齐, </p>
<h4 id="添加fragment"><a href="#添加fragment" class="headerlink" title="添加fragment"></a>添加fragment</h4><p>右键 -&gt; new -&gt; Fragment -&gt; Fragment(Blank), 依次添加 ListFragment, DetailFragment, AddFragment.</p>
<h4 id="主界面移植"><a href="#主界面移植" class="headerlink" title="主界面移植"></a>主界面移植</h4><p>思路：主界面的移植对应 activity_main.xml 与 fragment_list.xml的修改, 此activity_main.xml 对应手机，此activity_main.xml中， listContainer的作用在于存放ListFragment, 这样main_acitivity 只需启动基本的读取json网络数据， 其余具体操作便全部放在ListFragment中。实际上，也可以不要container，直接往activity_xxx.xml里面添加fragment，建议使用前一种方法。</p>
<p>activity_main.xml:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot; android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot; tools:context=&quot;.MainActivity&quot;</span><br><span class="line">    android:id=&quot;@+id/Forum_final&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:orientation=&quot;horizontal&quot;</span><br><span class="line">        android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height=&quot;fill_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;FrameLayout</span><br><span class="line">            android:id=&quot;@+id/listContainer&quot; </span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;fill_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;4&quot;</span><br><span class="line">            android:layout_margin=&quot;@dimen/abc_action_bar_default_padding_material&quot;&gt;</span><br><span class="line">	&lt;/FrameLayout&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>fragment_list.xml:<br><img src="http://ww4.sinaimg.cn/large/690aa174gw1epsz5ub4kmj209u0d5mxi.jpg" alt="fragment_list"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;com.example.lin.lin_homework_v01.ListFragment&quot;</span><br><span class="line">    android:id=&quot;@+id/Fragment_List&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- TODO: Update blank fragment layout --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;462dp&quot;</span><br><span class="line">        android:id=&quot;@+id/listView_All&quot;</span><br><span class="line">        android:background=&quot;@drawable/back&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentEnd=&quot;true&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView&quot;</span><br><span class="line">        android:layout_above=&quot;@+id/button_Add_Frag&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Add a Message&quot;</span><br><span class="line">        android:id=&quot;@+id/button_Add_fl&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">        android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_horizontal|bottom&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/FrameLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>在MainActivity.java 中， 由于MainActivity调用了ListFragment, 因此要implement ListFragment的监听函数。其他的fragment也是同理。同时， 加入onFragmentInteraction函数。 代码如下所示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends ActionBarActivity</span><br><span class="line">        implements ListFragment.OnFragmentInteractionListener, // </span><br><span class="line">		   DetailFragment.OnFragmentInteractionListener,</span><br><span class="line">                   AddFragment.OnFragmentInteractionListener</span><br><span class="line">&#123;</span><br><span class="line">    ... //省略很多函数</span><br><span class="line">    ...</span><br><span class="line">    public void onFragmentInteraction(Uri uri) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MainActivity与ListFragment之间的通信，MainActivity 通过调用ListFragment的update()函数传递消息给ListFragment。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ListFragment listFrag = new ListFragment();</span><br><span class="line">FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span><br><span class="line">fragmentTransaction.replace(R.id.listContainer,listFrag);</span><br><span class="line">fragmentTransaction.commit();</span><br><span class="line">listFrag.update(); //update是自己添加的函数，主要负责刷新ListFragment的界面。</span><br></pre></td></tr></table></figure>
<p>MainActivity与ListFragment之间的通信，ListFragment如果想传递消息给MainActivity， 只需在ListFragment中的OnFragmentInteractionListener中声明传递消息函数，在MainActivity实现即可。 这里传递消息的函数是OnItemClick(int pos)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class ListFragment extends Fragment &#123;</span><br><span class="line">    </span><br><span class="line">    ....//省略很多函数</span><br><span class="line">    </span><br><span class="line">    public interface OnFragmentInteractionListener &#123;</span><br><span class="line">        // TODO: Update argument type and name</span><br><span class="line">        public void onFragmentInteraction(Uri uri);</span><br><span class="line">        public void OnItemClick(int pos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends ActionBarActivity</span><br><span class="line">        implements ListFragment.OnFragmentInteractionListener, //</span><br><span class="line">                   DetailFragment.OnFragmentInteractionListener,</span><br><span class="line">                   AddFragment.OnFragmentInteractionListener</span><br><span class="line">&#123;</span><br><span class="line">    ... //省略很多函数</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    /* receive position from list fragment*/</span><br><span class="line">    public void OnItemClick(int pos)&#123;</span><br><span class="line">	...	//省略具体实现</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息显示界面移植"><a href="#消息显示界面移植" class="headerlink" title="消息显示界面移植"></a>消息显示界面移植</h4><p>思路： 此原理类似activity_main.xml， activity_display_message.xml 只负责启动detail_fragment， 因此只存放一个detail_Container, 详细操作放在detail_fragment中。 </p>
<p>activity_display_message.xml:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot; android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    tools:context=&quot;com.example.lin.lin_homework_v01.DisplayMessageActivity&quot;</span><br><span class="line">    android:id=&quot;@+id/detail_Container&quot;&gt;</span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>fragment_detail.xml:<br><img src="http://ww4.sinaimg.cn/large/690aa174gw1epsz75e3f2j208g0cvwey.jpg" alt="fragment_detail"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;com.example.lin.lin_homework_v01.DetailFragment&quot;</span><br><span class="line">    android:id=&quot;@+id/Fragment_Detail&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@drawable/back&quot;</span><br><span class="line">    android:weightSum=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- TODO: Update blank fragment layout --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;236dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Title&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_2&quot;</span><br><span class="line">        android:layout_marginTop=&quot;29dp&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_Author_Frag&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;43dp&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;here shows the title&quot;</span><br><span class="line">        android:background=&quot;@drawable/back&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_Title_Frag&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_2&quot;</span><br><span class="line">        android:layout_alignRight=&quot;@+id/textView_Author_Frag&quot;</span><br><span class="line">        android:layout_alignEnd=&quot;@+id/textView_Author_Frag&quot;</span><br><span class="line">        android:editable=&quot;true&quot;</span><br><span class="line">        android:enabled=&quot;true&quot;</span><br><span class="line">        android:focusable=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Author&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_1&quot;</span><br><span class="line">        android:layout_alignParentTop=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;43dp&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;here shows the author&quot;</span><br><span class="line">        android:background=&quot;@drawable/back&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_Author_Frag&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_1&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentEnd=&quot;true&quot;</span><br><span class="line">        android:editable=&quot;true&quot;</span><br><span class="line">        android:enabled=&quot;true&quot;</span><br><span class="line">        android:autoText=&quot;false&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Date&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_3&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_Title_Frag&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_marginTop=&quot;29dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;33dp&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;here shows the date&quot;</span><br><span class="line">        android:background=&quot;@drawable/back&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_Date_Frag&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_3&quot;</span><br><span class="line">        android:layout_alignRight=&quot;@+id/textView_Title_Frag&quot;</span><br><span class="line">        android:layout_alignEnd=&quot;@+id/textView_Title_Frag&quot;</span><br><span class="line">        android:editable=&quot;true&quot;</span><br><span class="line">        android:enabled=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Message&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_4&quot;</span><br><span class="line">        android:layout_marginTop=&quot;30dp&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_Date_Frag&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;175dp&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;here shows the message&quot;</span><br><span class="line">        android:background=&quot;@drawable/back&quot;</span><br><span class="line">        android:id=&quot;@+id/textView_Message_Frag&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView_4&quot;</span><br><span class="line">        android:layout_alignRight=&quot;@+id/textView_Date_Frag&quot;</span><br><span class="line">        android:layout_alignEnd=&quot;@+id/textView_Date_Frag&quot;</span><br><span class="line">        android:layout_above=&quot;@+id/button_Add_Frag&quot;</span><br><span class="line">        android:editable=&quot;true&quot;</span><br><span class="line">        android:enabled=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        tools:context=&quot;com.example.lin.lin_homework_v01.DetailFragment&quot;</span><br><span class="line">        android:weightSum=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">        android:layout_width=&quot;30dp&quot;</span><br><span class="line">        android:layout_height=&quot;50dp&quot;</span><br><span class="line">        android:text=&quot;Prev&quot;</span><br><span class="line">        android:id=&quot;@+id/button_ShowPrev&quot;</span><br><span class="line">        android:onClick=&quot;Show_Prev_Message&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_weight=&quot;0.33&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">        android:layout_width=&quot;30dp&quot;</span><br><span class="line">        android:layout_height=&quot;50dp&quot;</span><br><span class="line">        android:text=&quot;Add&quot;</span><br><span class="line">        android:id=&quot;@+id/button_Add_fd&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">        android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">        android:layout_weight=&quot;0.35&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:layout_width=&quot;30dp&quot;</span><br><span class="line">            android:layout_height=&quot;50dp&quot;</span><br><span class="line">            android:text=&quot;Next&quot;</span><br><span class="line">            android:id=&quot;@+id/button_ShowNext&quot;</span><br><span class="line">            android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">            android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">            android:layout_alignParentEnd=&quot;true&quot;</span><br><span class="line">            android:layout_weight=&quot;0.35&quot; /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>注意.xml文件中LinearLayout的使用， 其对布局有重要影响。</p>
<p>同MainActivity， DisplayMessageActivity 也需要implements DetailFragment.OnFragmentInteractionListener</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class DisplayMessageActivity extends ActionBarActivity implements DetailFragment.OnFragmentInteractionListener&#123;</span><br><span class="line">    ....// 省略很多函数</span><br><span class="line">    public void onFragmentInteraction(Uri uri) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DisplayMessageActivity 在接收到发自MainActivity的位置信息cur_p以后，启动DetailFragment并传递cur_p。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class DisplayMessageActivity extends ActionBarActivity implements DetailFragment.OnFragmentInteractionListener&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, &quot;Display Message Activity starts...&quot;);</span><br><span class="line"></span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_display_message);</span><br><span class="line"></span><br><span class="line">        /*receive message coming from other activity, main activity or Display Post List Activity*/</span><br><span class="line">        Intent intent = getIntent();</span><br><span class="line">        cur_p = (int)intent.getSerializableExtra(MainActivity.SHOW_POST_MESSAGE);</span><br><span class="line"></span><br><span class="line">        /* start detail fragment, replace detail_Container with detailFragment */</span><br><span class="line">        DetailFragment detailFrag = new DetailFragment();</span><br><span class="line">        FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span><br><span class="line">        fragmentTransaction.replace(R.id.detail_Container, detailFrag);</span><br><span class="line"></span><br><span class="line">        /* transmit the position to detail fragment*/</span><br><span class="line">        Bundle bundle = new Bundle();</span><br><span class="line">        bundle.putInt(&quot;position_communication&quot;, cur_p);</span><br><span class="line">        detailFrag.setArguments(bundle);</span><br><span class="line"></span><br><span class="line">        fragmentTransaction.commit();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 DetailFragment里, 需要接收位置信息， 并填充到各个控件中。同时， 还需要设置Prev，Add，Next 这三个按钮的监听函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">public class DetailFragment extends Fragment &#123;</span><br><span class="line">    ...// 略</span><br><span class="line">    private int cur_p;</span><br><span class="line">    private View view;</span><br><span class="line">    TextView title_TextView;</span><br><span class="line">    TextView author_TextView;</span><br><span class="line">    TextView time_TextView;</span><br><span class="line">    TextView message_TextView;</span><br><span class="line">    Button prev_Button;</span><br><span class="line">    Button next_Button;</span><br><span class="line">    Button add_Button;</span><br><span class="line">    ...//略</span><br><span class="line"></span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState) &#123;</span><br><span class="line">        // Inflate the layout for this fragment</span><br><span class="line"></span><br><span class="line">        // Get position from the list activity</span><br><span class="line">        Log.d(TAG, &quot;onCreateView starts...&quot;);</span><br><span class="line"></span><br><span class="line">        view = inflater.inflate(R.layout.fragment_detail, container, false);</span><br><span class="line">        title_TextView   = (TextView)view.findViewById(R.id.textView_Title_Frag);</span><br><span class="line">        author_TextView  = (TextView)view.findViewById(R.id.textView_Author_Frag);</span><br><span class="line">        time_TextView    = (TextView)view.findViewById(R.id.textView_Date_Frag);</span><br><span class="line">        message_TextView = (TextView)view.findViewById(R.id.textView_Message_Frag);</span><br><span class="line">        prev_Button      = (Button)view.findViewById(R.id.button_ShowPrev);</span><br><span class="line">        next_Button      = (Button)view.findViewById(R.id.button_ShowNext);</span><br><span class="line">        add_Button       = (Button)view.findViewById(R.id.button_Add_fd);</span><br><span class="line">        setOnClickListenerForAll();</span><br><span class="line"></span><br><span class="line">        /* receive position data */</span><br><span class="line">        cur_p = (int) getArguments().getInt(&quot;position_communication&quot;);</span><br><span class="line">        Log.d(TAG, &quot;receive: &quot; + cur_p);</span><br><span class="line">        if(cur_p &lt; MainActivity.posts.size()) &#123;</span><br><span class="line">            update(cur_p);</span><br><span class="line">        &#125;else</span><br><span class="line">        &#123;</span><br><span class="line">            Log.d(TAG, &quot;post array is empty now&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return view;  //注意， 这里不能return inflater.inflate(R.layout.fragment_detail, container, false); 不然数据无法正常显示！ 可能是因为每次inflater.inflate(R.layout.fragment_detail, container, false) 的结果都不一样。 这个bug我找了半天！</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...//略</span><br><span class="line"></span><br><span class="line">    public void setOnClickListenerForAll() // 设置三个按钮的监听函数</span><br><span class="line">    &#123;</span><br><span class="line">        prev_Button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Log.d(TAG, &quot;show previous message&quot;);</span><br><span class="line">                Show_Prev_Message();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        next_Button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Log.d(TAG, &quot;show next message&quot;);</span><br><span class="line">                Show_Next_Message();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        add_Button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Log.d(TAG, &quot;add message&quot;);</span><br><span class="line">                Add_Message();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="添加消息界面移植"><a href="#添加消息界面移植" class="headerlink" title="添加消息界面移植"></a>添加消息界面移植</h4><p>思路： 同上。</p>
<p>activity_add_message.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot; android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    tools:context=&quot;com.example.lin.lin_homework_v01.AddMessageActivity&quot;</span><br><span class="line">    android:id=&quot;@+id/new_post_Container&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>fragment_add.xml:<br><img src="http://ww4.sinaimg.cn/large/690aa174gw1epsz86ue6rj20790ctdg1.jpg" alt="fragment_add"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    tools:context=&quot;com.example.lin.lin_homework_v01.AddFragment&quot;</span><br><span class="line">    android:weightSum=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- TODO: Update blank fragment layout --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Author&quot;</span><br><span class="line">        android:id=&quot;@+id/textView2&quot;</span><br><span class="line">        android:layout_alignParentTop=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:id=&quot;@+id/editText_Author&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView2&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Title&quot;</span><br><span class="line">        android:id=&quot;@+id/textView3&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/editText_Author&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_marginTop=&quot;30dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:layout_width=&quot;369dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:id=&quot;@+id/editText_Title&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView3&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_alignRight=&quot;@+id/editText_Author&quot;</span><br><span class="line">        android:layout_alignEnd=&quot;@+id/editText_Author&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;</span><br><span class="line">        android:text=&quot;Message&quot;</span><br><span class="line">        android:id=&quot;@+id/textView4&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/editText_Title&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_marginTop=&quot;29dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:inputType=&quot;textMultiLine&quot;</span><br><span class="line">        android:ems=&quot;10&quot;</span><br><span class="line">        android:id=&quot;@+id/editText_Message&quot;</span><br><span class="line">        android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">        android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/textView4&quot;</span><br><span class="line">        android:layout_alignRight=&quot;@+id/editText_Title&quot;</span><br><span class="line">        android:layout_alignEnd=&quot;@+id/editText_Title&quot;</span><br><span class="line">        android:layout_weight=&quot;0.70&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Add&quot;</span><br><span class="line">        android:id=&quot;@+id/button_AddMessage&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot;</span><br><span class="line">        android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_horizontal&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="适应平板功能"><a href="#适应平板功能" class="headerlink" title="适应平板功能"></a>适应平板功能</h3><p>Android 对当前设备是手机还是平板， 有自动检测机制。 只需在res目录下新建名为layout-large的文件夹，并将原来layout里的所有的xml拷贝过去， 再稍微修改activity_main.xml即可。</p>
<p>下面是layout-large里的对应平板的activity_main.xml， 只在原来的基础上添加了detailContainer， 以便放置DetailFragment 和AddFragment。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot; android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot; tools:context=&quot;.MainActivity&quot;</span><br><span class="line">    android:id=&quot;@+id/Forum_final&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:orientation=&quot;horizontal&quot;</span><br><span class="line">        android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height=&quot;fill_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;FrameLayout</span><br><span class="line">            android:id=&quot;@+id/listContainer&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;fill_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;4&quot;</span><br><span class="line">            android:layout_margin=&quot;@dimen/abc_action_bar_default_padding_material&quot;&gt;&lt;/FrameLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;FrameLayout</span><br><span class="line">            android:id=&quot;@+id/detailContainer&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;fill_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;6&quot;</span><br><span class="line">            android:layout_margin=&quot;@dimen/abc_action_bar_default_padding_material&quot;&gt;&lt;/FrameLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>仅仅只是添加detailContainer还不够，还需要修改MainActivity.java的代码。</p>
<p>若Android检测当前设备为平板， 则会自动加载laylout-large里的activity_main.xml的文件。因此，只需要检测是否存在detailContainer即可判定当前的设备是平板还是手机。因此， 添加 IsTablet。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends ActionBarActivity</span><br><span class="line">        implements ListFragment.OnFragmentInteractionListener,</span><br><span class="line">                   DetailFragment.OnFragmentInteractionListener,</span><br><span class="line">                   AddFragment.OnFragmentInteractionListener&#123;</span><br><span class="line">    ...// 省略</span><br><span class="line">    static boolean isTablet = false;</span><br><span class="line">    ...//省略</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        setTitle(&quot;IsiForum_v3&quot;);</span><br><span class="line"></span><br><span class="line">        FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span><br><span class="line">        fragmentTransaction.replace(R.id.listContainer,listFrag);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if(findViewById(R.id.detailContainer) == null)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.d(TAG, &quot;this is phone&quot;);</span><br><span class="line">            isTablet = false;</span><br><span class="line"></span><br><span class="line">        &#125;else</span><br><span class="line">        &#123;</span><br><span class="line">            Log.d(TAG, &quot;this is tablet&quot;);</span><br><span class="line">            isTablet = true;</span><br><span class="line">            /*start add fragment*/</span><br><span class="line">            AddFragment addFragment = new AddFragment();</span><br><span class="line">            fragmentTransaction.replace(R.id.detail_Container,addFragment);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        fragmentTransaction.commit();</span><br><span class="line">        Update = true;</span><br><span class="line">        handler.postDelayed(runnable, 100);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于手机，当用户点击主界面的某一条消息时，程序只需要启动DisplayMessageActivity, 而对于平板， 由于空间剩余甚大，因此启动DetailFragment。使用fragmentTransaction.replace(R.id.detailContainer, detailFragment) 来将detailFragment放置到detailContainer处。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends ActionBarActivity</span><br><span class="line">        implements ListFragment.OnFragmentInteractionListener,</span><br><span class="line">                   DetailFragment.OnFragmentInteractionListener,</span><br><span class="line">                   AddFragment.OnFragmentInteractionListener&#123;</span><br><span class="line"> </span><br><span class="line">    ...// 省略</span><br><span class="line">    /* receive position from list fragment*/</span><br><span class="line">    public void OnItemClick(int pos)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, &quot;MainActivity receive: &quot; + pos + &quot; from ListFragment&quot;);</span><br><span class="line"></span><br><span class="line">        if(!isTablet) // phone</span><br><span class="line">        &#123;</span><br><span class="line">            Intent intent = new Intent(this, DisplayMessageActivity.class);</span><br><span class="line">            intent.putExtra(MainActivity.SHOW_POST_MESSAGE, pos);</span><br><span class="line">            startActivity(intent);</span><br><span class="line"></span><br><span class="line">        &#125;else &#123;</span><br><span class="line"></span><br><span class="line">            Log.d(TAG, &quot;position: &quot; + pos + &quot;, start creating detail fragment...&quot;);</span><br><span class="line"></span><br><span class="line">            DetailFragment detailFragment = new DetailFragment();</span><br><span class="line">            FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span><br><span class="line"></span><br><span class="line">            Bundle bundle = new Bundle();</span><br><span class="line">            bundle.putInt(&quot;position_communication&quot;, pos);</span><br><span class="line">            detailFragment.setArguments(bundle);</span><br><span class="line"></span><br><span class="line">            fragmentTransaction.replace(R.id.detailContainer, detailFragment);</span><br><span class="line">            fragmentTransaction.commit();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    ...// 省略</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（注： 不知是因为android studio的bug还是其他原因，以平板作为仿真设备，android还是加载layout里的xml文件。 但同学使用同样的方法，显示正常。除此以外， 尝试修改layout里的activity_main.xml， 以手机作为平板，所有的功能运行正常。此bug以后排除, mark at 2015-03-07 20：56）</p>
<p>本实验代码位于： <a href="https://github.com/ShelmyLin/java_Forum" target="_blank" rel="noopener">我的Github</a> </p>

            
          </div>

          

          <footer class="article-footer">
            <a data-url="http://yoursite.com/2015/03/08/android/android_forum/" data-id="cjow1orad001jlsayh96lj2tr" class="article-share-link">Share</a>
            
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/android-programming/">android programming</a></li></ul>

          </footer>

        </div>

        
          
<nav id="article-nav" class="white">
  <div class="nav-wrapper">
    <ul class="row">
    
      <li class="col s6">
        <a href="/2015/03/08/android/android_theory/" id="article-nav-newer" class="article-nav-link-wrap grey-text text-darken-1 truncate">
          <i class="fa fa-arrow-left"></i>
          <span class="article-nav-title">Android 基础理论</span>
        </a>
      </li>
    

    
      <li class="col s6">
        <a href="/2015/03/05/France/" id="article-nav-older" class="article-nav-link-wrap grey-text text-darken-1 right-align truncate">
          <span class="article-nav-title">Life in Clermont-Ferrand</span>
          <i class="fa fa-arrow-right"></i>
        </a>
      </li>
    

    </ul>
  </div>
</nav>


        
      </article>


      



    </div>
  </div>
</div>


  



  </div>

  <footer class="page-footer grey darken-2">
    <div class="footer-copyright">
      <div class="container">
        &copy; 2018 Xiongmin Lin

        <div class="right">
          Powered by <a href="http://hexo.io/" rel="nofollow" class="white-text" target="_blank">Hexo</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="/js/app.js"></script>

</body>
</html>
